<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MSSU NCR-CL Lighthouse Keepers Daily Log</title>
<style>
  body { font-family: Arial, sans-serif; background: #ffffff; margin: 20px; }
  .container { background: #0066cc; color: black; padding: 20px; border-radius: 8px; max-width: 800px; margin: auto; }
  h1 { text-align: center; }
  .hidden { display: none; }
  select, input { padding: 8px; margin: 5px; width: 48%; }
  button { padding: 15px 25px; font-size: 16px; margin: 5px; font-weight: bold; border: none; border-radius: 5px; cursor: pointer; }
  #loginBtn { width: 100%; background: #0044aa; color: white; }
  #timeInBtn { background: green; color: black; width: 48%; }
  #timeOutBtn { background: red; color: black; width: 48%; }
  .row { display: flex; flex-wrap: wrap; justify-content: space-between; }
</style>
</head>
<body>
<div class="container">
  <h1>MSSU NCR-CL Lighthouse Keepers Daily Log</h1>

  <!-- Login Button -->
  <div id="loginDiv">
    <button id="loginBtn">MSSU NCR-CL LK DAILY LOG IN</button>
  </div>

  <!-- Attendance Form -->
  <div id="attendanceDiv" class="hidden">
    <div class="row">
      <div>
        <label for="lkName">Name of LK</label><br>
     <select id="lkName">
  <option value="">-- choose name --</option>
  <option value="LK2 Eduardo Santos">LK2 Eduardo Santos</option>
  <option value="LK2 Julius L Galang">LK2 Julius L Galang</option>
  <option value="LK2 Royette D Lagoc">LK2 Royette D Lagoc</option>
  <option value="LK1 Andrew L Catapang">LK1 Andrew L Catapang</option>
  <option value="LK1 Edwin Apatan">LK1 Edwin Apatan</option>
  <option value="LK1 Joie G Raval">LK1 Joie G Raval</option>
  <option value="LK1 Jessie L Pasawa">LK1 Jessie L Pasawa</option>
  <option value="LK1 Renie Arce">LK1 Renie Arce</option>
  <option value="LK2 Edwin C Lopez">LK2 Edwin C Lopez</option>
  <option value="LK2 Amorsolo W Lagoc">LK2 Amorsolo W Lagoc</option>
</select>

      </div>
      <div>
        <label for="lsName">Name of LS (required)</label><br>
        <input type="text" id="lsName" placeholder="e.g. Corregidor Light Station" required>
      </div>
      <div>
        <label for="aor">CGS/CGSS Area of Responsibility (AOR) (required)</label><br>
        <input type="text" id="aor" placeholder="e.g. CGS or CGSS" required>
      </div>
    </div>

    <div class="row">
      <button id="timeInBtn">TIME-IN</button>
      <button id="timeOutBtn">TIME-OUT</button>
    </div>

    <p>Recorded time uses Philippine Time (Asia/Manila). This page syncs with a Google Sheet so multiple devices share submissions.</p>
    <p id="lastSync"></p>
  </div>
</div>

<script>
const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxgUDCXWZdFVnGGNDYYioiot6BMK8UtnAmOKrK3P3umgkdgHQ5IjRwHlVWXb_Wu43na/exec';

const loginBtn = document.getElementById('loginBtn');
const loginDiv = document.getElementById('loginDiv');
const attendanceDiv = document.getElementById('attendanceDiv');

const timeInBtn = document.getElementById('timeInBtn');
const timeOutBtn = document.getElementById('timeOutBtn');

const lkNameSelect = document.getElementById('lkName');
const lsInput = document.getElementById('lsName');
const aorInput = document.getElementById('aor');
const lastSync = document.getElementById('lastSync');

// Login button click
loginBtn.addEventListener('click', () => {
  loginDiv.classList.add('hidden');
  attendanceDiv.classList.remove('hidden');
});

// Get Philippine time
function getPhilippineTime() {
  const now = new Date();
  const pht = now.toLocaleString("en-PH", {timeZone: "Asia/Manila"});
  return { iso: now.toISOString(), pht, date: pht.split(',')[0] };
}

// Submit attendance
async function submitAttendance(action) {
  const lkName = lkNameSelect.value;
  const ls = lsInput.value.trim();
  const aor = aorInput.value.trim();

  if (!lkName) { alert("Please select your name."); return; }
  if (!ls || !aor) { alert("LS and AOR are required."); return; }
  if (action === 'TIME-OUT' && !lkNameSelect.dataset.timeIn) {
    alert("You must TIME-IN first."); return;
  }

  const { iso, pht, date } = getPhilippineTime();
  const data = { 
    Timestamp_ISO: iso, Timestamp_PHT: pht, Date: date,
    Action: action, Name: lkName, Purpose: '', LS: ls, AOR: aor, UserAgent: navigator.userAgent
  };

  try {
    const resp = await fetch(SCRIPT_URL, {
      method: 'POST',
      body: JSON.stringify(data)
    });
    const result = await resp.json();

    if (result.status === 'success') {
      alert(result.message);

     if (action === 'TIME-IN') {
  lkNameSelect.dataset.timeIn = true;

  // Safe removal of selected name from dropdown
  const optionToRemove = lkNameSelect.querySelector(`option[value="${lkName}"]`);
  if (optionToRemove) {
    optionToRemove.remove();
  }
}

      if (action === 'TIME-OUT') {
        timeInBtn.disabled = true;
        timeOutBtn.disabled = true;
        const seeYou = document.createElement('p');
        seeYou.textContent = "SEE YOU TOMORROW";
        seeYou.style.fontWeight = 'bold';
        seeYou.style.fontSize = '18px';
        attendanceDiv.appendChild(seeYou);
      }

    } else {
      alert("Error: " + result.message);
    }

  } catch(err) {
    alert("Submission failed: " + err);
  }

  lastSync.textContent = "Last sync: " + pht;
}

timeInBtn.addEventListener('click', () => submitAttendance('TIME-IN'));
timeOutBtn.addEventListener('click', () => submitAttendance('TIME-OUT'));
</script>
</body>
</html>

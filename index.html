<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MSSU NCR-CL Lighthouse Keepers Daily Log</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #ffffff;
      margin: 0;
      padding: 0;
    }

    .container {
      background: #ffffff;
      color: black;
      padding: 30px;
      width: 100vw;
      min-height: 100vh;
      box-sizing: border-box;
    }

    h1 {
      color: #0044aa;
      text-align: center;
    }

    .row.parameters {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
    }

    .row {
      display: flex;
      justify-content: space-between;
      margin-top: 20px;
    }

    select, input {
      padding: 10px;
      margin-top: 5px;
      width: 100%;
      box-sizing: border-box;
      background-color: #ffffff;
      color: #0044aa;
      border: 2px solid #0044aa;
      border-radius: 5px;
    }

    button {
      padding: 15px 25px;
      font-size: 16px;
      font-weight: bold;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    #loginBtn, #installBtn {
      width: 100%;
      background: #0044aa;
      color: white;
      margin-bottom: 10px;
    }

    #timeInBtn {
      background: green;
      color: black;
      width: 48%;
    }

    #timeOutBtn {
      background: red;
      color: black;
      width: 48%;
    }

    .hidden {
      display: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>MSSU NCR-CL Lighthouse Keepers Daily Log</h1>

    <!-- Login Section -->
    <div id="loginDiv">
      <button id="loginBtn">MSSU NCR-CL LK DAILY LOG IN</button>
      <button id="installBtn">Install LK Attendance</button>
    </div>

    <!-- Attendance Form -->
    <div id="attendanceDiv" class="hidden">
      <div class="row parameters">
        <div>
          <label for="lkName">Name of LK</label><br>
          <select id="lkName">
            <option value="">-- choose name --</option>
            <option value="LK2 Eduardo Santos">LK2 Eduardo Santos</option>
            <option value="LK2 Julius L Galang">LK2 Julius L Galang</option>
            <option value="LK2 Royette D Lagoc">LK2 Royette D Lagoc</option>
            <option value="LK1 Andrew L Catapang">LK1 Andrew L Catapang</option>
            <option value="LK1 Edwin Apatan">LK1 Edwin Apatan</option>
            <option value="LK1 Joie G Raval">LK1 Joie G Raval</option>
            <option value="LK1 Jessie L Pasawa">LK1 Jessie L Pasawa</option>
            <option value="LK1 Renie Arce">LK1 Renie Arce</option>
            <option value="LK2 Edwin C Lopez">LK2 Edwin C Lopez</option>
            <option value="LK2 Amorsolo W Lagoc">LK2 Amorsolo W Lagoc</option>
          </select>
        </div>
        <div>
          <label for="lsName">Name of LS (required)</label><br>
          <input type="text" id="lsName" placeholder="e.g. Corregidor Light Station" required>
        </div>
        <div>
          <label for="aor">CGS/CGSS Area of Responsibility (AOR)</label><br>
          <input type="text" id="aor" placeholder="e.g. CGS or CGSS" required>
        </div>
        <div>
          <label for="whereabout">LK Whereabout</label><br>
          <input type="text" id="whereabout" placeholder="e.g. On duty at Corregidor">
        </div>
        <div>
          <label for="output">Today's Output</label><br>
          <input type="text" id="output" placeholder="e.g. Maintenance completed, report submitted">
        </div>
      </div>

      <div class="row">
        <button id="timeInBtn">TIME-IN</button>
        <button id="timeOutBtn">TIME-OUT</button>
      </div>

      <p id="lastSync"></p>
    </div>
  </div>

  <script>
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzMbLqlVuoS0dl3C72b4VfRH9WZpzgAKtwlw_4eeP-GpeOqUnFLIUfKb3EKpv2CYlLw/exec';

    const loginBtn = document.getElementById('loginBtn');
    const installBtn = document.getElementById('installBtn');
    const loginDiv = document.getElementById('loginDiv');
    const attendanceDiv = document.getElementById('attendanceDiv');
    const timeInBtn = document.getElementById('timeInBtn');
    const timeOutBtn = document.getElementById('timeOutBtn');
    const lkNameSelect = document.getElementById('lkName');
    const lsInput = document.getElementById('lsName');
    const aorInput = document.getElementById('aor');
    const whereaboutInput = document.getElementById('whereabout');
    const outputInput = document.getElementById('output');
    const lastSync = document.getElementById('lastSync');

    // ✅ Login button logic
    loginBtn.addEventListener('click', () => {
      loginDiv.classList.add('hidden');
      attendanceDiv.classList.remove('hidden');
      installBtn.style.display = 'none';
    });

    function getPhilippineTime() {
      const now = new Date();
      const pht = now.toLocaleString("en-PH", { timeZone: "Asia/Manila" });
      return { iso: now.toISOString(), pht, date: pht.split(',')[0] };
    }

    async function submitAttendance(action) {
      const lkName = lkNameSelect.value;
      const ls = lsInput.value.trim();
      const aor = aorInput.value.trim();
      const whereabout = whereaboutInput.value.trim();
      const output = outputInput.value.trim();

      if (!lkName || !ls || !aor) {
        alert("Please complete all required fields.");
        return;
      }

      const { iso, pht, date } = getPhilippineTime();
      const data = {
        Timestamp_ISO: iso,
        Timestamp_PHT: pht,
        Date: date,
        Action: action,
        Name: lkName,
        Purpose: '',
        LS: ls,
        AOR: aor,
        Whereabout: whereabout,
        Output: output,
        UserAgent: navigator.userAgent
      };

      try {
        await fetch(SCRIPT_URL, {
          method: 'POST',
          mode: 'no-cors',   // bypasses CORS blocking
          body: JSON.stringify(data),
          headers: { 'Content-Type': 'application/json' }
        });
        // ✅ Friendlier success message
        alert("Attendance recorded successfully!");
      } catch (err) {
        alert("Submission failed: " + err);
      }

      lastSync.textContent = "Last sync: " + pht;
    }

    timeInBtn.addEventListener('click', () => submitAttendance('TIME-IN'));
    timeOutBtn.addEventListener('click', () => submitAttendance('TIME-OUT'));
  </script>
</body>
</html>
